# Chapter 2 리팩터링 원칙

## 리팩터링 정의
- 동작을 보존하는 작은 단계들을 거쳐 코드를 수정하고, 이러한 단계들을 순차적으로 연결하여 큰 변화를 만들어내는 일
- 리팩터링하기 전과 후의 코드가 똑같이 동작해야 한다.
- 리팩터링 과정에서 발견된 버그는 리팩터링 후에도 그대로 남아있어야 한다.
- 리팩터링은 성능 최적화와는 다른 개념

---

## 리팩터링 하는 이유
- 중복 코드 제거는 설계 개선 작업의 중요한 한 축이다. 중복 코드를 제거하면 모든 코드가 언제나 고유한 일을 수행함을 보장할 수 있다.
- 내부 설계가 잘 된 소프트웨어는 새로운 기능을 추가할 지점과 어떻게 고칠지 쉽게 찾을 수 있다. 모듈화가 잘 되어 있으면 전체 코드베이스 중 작은 일부만 이해하면 된다. -> 오히려 빠른 개발 속도

---

## 언제 리팩터링해야 할까?
- 리팩터링하기 가장 좋은 시점은 코드베이스에 기능을 새로 추가하기 직전이다.
- 복제 코드를 사용하면, 복제한 코드를 나중에 수정할 일이 생기면 원래 코드와 복제한 코드를 모두 수정해야한다. 버그도 마찬가지다. 기능을 쉽게 추가하게 만들기 위하여 리팩토링이 필요하다.
- 역할에 맞게 변수, 함수 이름 정하기, 긴 함수 잘게 나누기, 내가 이해한 것을 코드에 반영해 둬라. -> 코드를 이해하기 쉽게 만드는 리팩토링을 하자.
- 간단히 수정할 수 있는 것은 즉시 고치고, 시간이 걸릴 일은 메모를 남긴 다음, 먼저 하던 일을 마무리하고 처리하자.
- 리팩터링을 따로 일정을 잡아두고 한다기보다 기능을 추가하거나 버그를 잡는 동안 등등 틈틈히 하자.
- 코드리뷰에 리팩터링 활용 👍
- ***리팩터링하지 말아야 할 때*** -> 지저분한 코드를 봐도 굳이 수정할 필요가 없을때나, 리팩터링하는 것보다 처음부터 새로 작성하는 게 쉬울 때

---

## 리팩터링 시 고려할 문제
- 리팩터링의 궁극적인 목적은 개발 속도를 높여서, 더 적은 노력으로 더 많은 가치를 창출하는 것이다.
- 리팩터링은 코드베이스를 예쁘게 꾸미는 데에 의미가 있는 것이 아니고, 기능 추가 시간을 줄이고, 버그 수정 시간을 줄이는 즉 경제적인 측면에서 의미가 있는 것이다.
- 기능별 브랜치의 통합 주기를 2~3일 단위 혹은 더 짧은 주기로 관리해야 한다.
- 기능별 브랜치들이 독립적으로 개발되는 기간이 길어질수록 머지가 복잡해지는 문제는 기하급수적으로 늘어난다.
- 자가 테스트 코드는 리팩터링을 할 수 있게 해줄 뿐만 아니라, 새 기능 추가도 훨씬 안전하게 진행할 수 있도록 도와준다.

---

## 리팩터링, 아키텍처, 애그니(YAGNI)
- 당장에 필요한 기능만으로 최대한 간결하게 만들어라.

---

## 리팩터링과 소프트웨어 개발 프로세스
- 지속적 통합(CI)을 적극 권장하는 이유는, 팀원 각자가 수행한 리팩터링 결과를 빠르게 동료와 공유할 수 있고, 조만간 삭제될 인터페이스를 이용하여 새로운 기능을 추가하는 일을 방지할 수 있고, 리팩터링한 결과가 다른 팀원의 작업에 문제를 일으키면 즉시 알아낼 수 있기 때문이다.

---

## 리팩터링과 성능
- 리팩터링을 하면 성능이 떨어질 수는 있지만, 떨어진 성능을 튜닝하기는 더 쉬워진다.
- 소프트웨어를 빠르게 만드는 비결은 먼저 튜닝하기 쉽게 만들고 나서 원하는 속도가 나게끔 튜닝하는 것이다.
- 성능을 개선하기 위해 코드를 수정하다 보면 프로그램은 다루기 어려운 형태로 변하기 쉽고 결국 개발이 느려진다.
- 성능 최적화에 돌이하기 전까지는 성능에 신경 쓰지 않고 코드를 다루기 쉽게 만드는데에 집중한다. 그리고 성능 최적화 단계에 이르렀을때, 프로파일러로 프로그램을 분석하여 시간과 공간을 잡아먹는 곳을 찾아내어, 성능에 큰 영향을 주는 부분만 작은 단계로 나눠서 최적화를 진행한다.
- 위와 같이 진행했을때, 얻는 이점은 리팩터링이 잘되어 있다면 기능 추가를 빨리 할 수 있어, 성능 최적화 시간에 좀 더 시간을 투자할 수 있는 점과 프로파일러가 지적해주는 코드의 범위가 더 좁아져 튜닝하기 쉬워질 것이다.

---

### 개인적으로 느낀 점
- 나는 코드베이스를 정리하거나 구조를 바꾸는 일이나 그냥 코드를 정리하는 의미로 두루뭉술하게 리팩터링을 이해해오고 있었다. 그건 오히려 재구성이라는 용어로 표현한다는 것을 배웠다. 리팩터링을 하는 동안에는 일부를 변경해도 모든 기능이 항상 올바르게 동작해야 하며 성능 최적화와는 다른 개념이라는걸 깨달았다.
- 나는 지금까지 리팩터링을 할 시간을 내나름대로 따로 시간을 정해 해오고 있었는데, 책에서 말하듯, 새로운 기능을 추가하거나 버그을 잡을때나 수시로 해주는게 좋을거 같다는 생각이 들었다. 기회가 될 때마다 리팩터링을 해보자!
- 기능별 브랜치의 통합주기를 짧게 해야된다는 글을 읽고, 현재 Timeline을 개발하고있는 Timeline base branch를 모든 기능을 추가한 다음에 한 번에 dev로 머지하겠다는 안일한 생각을 했던 것에 다시 생각해보는 계기가 되었다. 생각해보니 이미 dev에 많은 수정사항들이 머지되고 난 후에, Timeline의 base branch를 dev로 머지하려고 할때, 엄청난 컨플릭트가 날거 같다.